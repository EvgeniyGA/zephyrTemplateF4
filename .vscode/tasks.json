{
    "version": "2.0.0",
    "tasks": [
        // {
        //     "label": "Build usbdfu",
        //     "type": "shell",
        //     "command": "west",
        //     "args": [
        //         "build",
		// 		"-p","always",
        //         "-b", "stm32f4_disco",
        //         "-d", "build_dfu",
        //         "../usbdfu",
        //         "--",
        //         //"-DCONFIG_MCUBOOT_SIGNATURE_KEY_FILE=\"C:/Projects/gitZephyr/mcuboot/root-rsa-2048.pem\"",
        //         "-DDTC_OVERLAY_FILE=C:/Projects/gitZephyr/zephyrTemplateF4/disco_f4_usbdfu.overlay"
        //     ],
        //     "group": "build",
        //     "problemMatcher": []
        // },
        {
            "label": "Build boot",
            "type": "shell",
            "command": "west",
            "args": [
                "build",
				"-p","always",
                "-b", "stm32f4_disco",
                "-d", "build_mcuboot",
                "../mcuboot/boot/zephyr",
                "--",
                "-DOVERLAY_CONFIG=C:/Projects/gitZephyr/zephyrTemplateF4/boot.conf",
                "-DDTC_OVERLAY_FILE=C:/Projects/gitZephyr/zephyrTemplateF4/disco_f4_boot.overlay"
            ],
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "Build",
            "type": "shell",
            "command": "west",
            "args": [
                "build",
				"-p", "always",
                "-b", "stm32f4_disco",
                "--",
                //"-DCONFIG_MCUBOOT_SIGNATURE_KEY_FILE=C:/Zephyr/zephyrproject/bootloader/mcuboot/root-rsa-2048.pem",
                "-DOVERLAY_CONFIG=prj.conf",
                "-DDTC_OVERLAY_FILE=disco_f4.overlay"
            ],
            "group": "build",
            "problemMatcher": []
        },
        // {
        //     "label": "Upload old",
        //     "type": "shell",
        //     "group": "build",
        //     "command": "mcumgr.exe",
        //     "args": [
        //     // "-t", "serial",
        //         "-d", "COM17",
        //         "-m", "4096",
        //         "-l", "8192",
        //     // "image",
        //         "upload",
        //         "${workspaceFolder}\\build\\zephyr\\zephyr.signed.bin"
        //     ],
        //     "problemMatcher": []
        // },
        {
            "label": "Upload",
            "type": "shell",
            "group": "build",
            "command": "mcumgr",
            "args": [
                "-c", "acm0", "image", "upload", "${workspaceFolder}\\build\\zephyr\\zephyr.signed.bin"
            ],
            "dependsOn": [],
            "problemMatcher": []
        },
        // {
        //     "label": "Config",
        //     "type": "shell",
        //     "command": "west build -t menuconfig",
        //     "group": "build",
        //     "problemMatcher": []
        // },
        //mcumgr conn add acm0 type="serial" connstring="dev=COM22,baud=115200"
        // {
        //     "label": "mcumgr add conn",
        //     "type": "shell",
        //     "command": "mcumgr",
        //     "args": [
        //         "conn", "add", "acm1", "type=serial",
        //         "connstring=\"dev=COM20,baud=115200\""
        //     ],
        //     "group": "build",
        //     "problemMatcher": []
        // },
        // {
        //     "label": "load by usb",
        //     "type": "shell",
        //    // "command": "west flash",
        //     "command": "dfu-util",
        //     "args": [
        //          "--alt", "1", "--download", "build/zephyr/zephyr.signed.bin"
        //     ],
        //     "group": "build",
        //     "problemMatcher": []
        // },
        {
            "label": "Flash boot",
            "type": "shell",
            "command": "C:\\Program Files\\STMicroelectronics\\STM32Cube\\STM32CubeProgrammer\\bin\\STM32_Programmer_CLI.exe",
            "args": [
                "--connect", "port=swd", "reset=HWrst",
                "--hardRst",
                "--download", "${workspaceFolder}\\build_mcuboot\\zephyr\\zephyr.elf"
            ],
            "group": "build",
            "problemMatcher": []
        },
        // {
        //     "label": "Flash usbdfu",
        //     "type": "shell",
        //     "command": "C:\\Program Files\\STMicroelectronics\\STM32Cube\\STM32CubeProgrammer\\bin\\STM32_Programmer_CLI.exe",
        //     "args": [
        //         "--connect", "port=swd", "reset=HWrst",
        //         "--hardRst",
        //         "--download", "${workspaceFolder}\\build_dfu\\zephyr\\zephyr.signed.bin",
        //         "0x08020000"
        //     ],
        //     "group": "build",
        //     "problemMatcher": []
        // },
        {
            "label": "Flash",
            "type": "shell",
            "command": "C:\\Program Files\\STMicroelectronics\\STM32Cube\\STM32CubeProgrammer\\bin\\STM32_Programmer_CLI.exe",
            "args": [
                "--connect", "port=swd", "reset=HWrst",
                "--hardRst",
                //"--erase", "0x08020000", "0x40000",
                //"--erase", "0x08060000", "0x40000",
                "--download", "${workspaceFolder}\\build\\zephyr\\zephyr.signed.hex"
                //,"0x08060000"
            ],
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "reset",
            "type": "shell",
            "command": "C:\\Program Files\\STMicroelectronics\\STM32Cube\\STM32CubeProgrammer\\bin\\STM32_Programmer_CLI.exe",
            "args": [
                "--connect", "port=swd",
                "--hardRst"
                //"--download", "${workspaceFolder}\\build\\zephyr\\zephyr.hex"
            ],
            "group": "build",
            "problemMatcher": []
        }
        // ,
        // {
        //     "label": "Clean",
        //     "type": "shell",
        //     "command": "rm -rf build",
        //     "group": "build",
        //     "problemMatcher": []
        // }
    ]
}
//../mcuboot/scripts/imgtool.py verify ./build/zephyr/zephyr.signed.bin
//..\mcuboot\scripts\imgtool.py verify build\zephyr\zephyr.signed.bin
//dumpinfo